<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Jogo da Velha">
    <title>Jogo da Velha</title>

    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bolaji-wc.netlify.com/">
    <meta property="og:title" content="Jogo da Velha">
    <meta property="og:image" content="img/favicon.png">
    <meta property="og:description" content="Jogo da Velha">
    <meta property="og:site_name" content="Jogo da Velha">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">


    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <section style="background-color: #50a050;display: flex;justify-content: center;align-items: center;">
        <div class="container" style="display: flex;justify-content: center;flex-wrap: wrap;align-items: center;">

            <div class="row" style="width: 100%;background-color: white;margin-bottom: 5pc;border-radius: 15px;">
                <div class="col-md-12 user-color" style="margin-bottom:20px; font-weight: 600; font-size: 30px;display: flex;justify-content: center;">Simbolo - <span id="simbolo"></span>

                </div>
                <div class="col-md-12 user-color" style="margin-bottom:20px; font-weight: 600; font-size: 30px;display: flex;justify-content: center;"> Jogador - <span id="player"></span>

                </div>
            </div>

            <div class="alinhamento jogo" style="display: flex;flex-direction: column;align-items: center;">

                <div class="row bordinha">
                    <div class="col-md-4 col-sm-4 velha" id="0-0"></div>
                    <div class="col-md-4 col-sm-4 velha" id="0-1"></div>
                    <div class="col-md-4 col-sm-4 velha" id="0-2"></div>
                </div>

                <div class="row bordinha">
                    <div class="col-md-4 col-sm-4 velha" id="1-0"></div>
                    <div class="col-md-4 col-sm-4 velha" id="1-1"></div>
                    <div class="col-md-4 col-sm-4 velha" id="1-2"></div>
                </div>

                <div class="row bordinha">
                    <div class="col-md-4 col-sm-4 velha" style="border-bottom: 0px;" id="2-0"></div>
                    <div class="col-md-4 col-sm-4 velha" style="border-bottom: 0px;" id="2-1"></div>
                    <div class="col-md-4 col-sm-4 velha" style="border-bottom: 0px;" id="2-2"></div>
                </div>


                <div class="row d-flex justify-content-center" style="padding-top: 4pc;">

                    <div class="col-md-6" style="display: flex;justify-content: center;">

                        <a href="home.html" id="btn-jogar" class="btn btn-primary" style="margin: auto">Recomeçar</a>

                    </div>
                    <div class="col-md-6" style="display: flex;justify-content: center;">

                        <a href="index.html" id="btn-jogar" class="btn btn-primary" style="margin: auto">Sair</a>

                    </div>

                </div>

                <div class="history"></div>
            </div>



        </div>

    </section>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


    <script type="text/javascript">
        let p = [
            ['p1', 'X'],
            ['p2', 'O']
        ];
        let player = Math.floor(Math.random() * 2);
        let aux_player;
        let history = [];
        let aux_history = [];

        let matrizPreechida = false;

        var items = [
            [null, null, null],
            [null, null, null],
            [null, null, null]
        ];


        $(document).ready(function() {

            console.log(localStorage);


            let p1 = localStorage.getItem('p1');
            let p2 = localStorage.getItem('p2');

            localStorage.setItem('currentPlayer', player);


            if (p1 == null || p2 == null) {

                location.href = 'index.html';

            } else {

                $('#player').text(localStorage.getItem(p[player][0]));
                $('#simbolo').text(p[player][1]);


            }


        });

        $('.velha').click(function() {

            aux_player = localStorage.getItem('currentPlayer');

            if (aux_player === '0') {

                localStorage.setItem('currentPlayer', 1);

            } else {

                localStorage.setItem('currentPlayer', 0);

            }

            $('#player').text(localStorage.getItem(p[aux_player][0]));
            $('#simbolo').text(p[aux_player][1]);

            $(this).html(p[aux_player][1]);


            matrizPosicao = this.id.split('-', 2);

            items[matrizPosicao[0]][matrizPosicao[1]] = aux_player;

            let verifica = verificaMatriz(aux_player);


            if (verifica.toString() == 0) {

                $('.jogo').html("<span class='winner'> " + localStorage.getItem('p1') + " <br>é o vencedor</span><br><img src='img/winner.png' style='width:50%;'><br>");
                aux_history = [localStorage.getItem('p1'), localStorage.getItem('p2'), localStorage.getItem('p1')];

                history.push(aux_history);
                localStorage.setItem('history', JSON.stringify(history));
            }
            if (verifica.toString() == 1) {

                $('.jogo').html("<span class='winner'> " + localStorage.getItem('p2') + " <br>é o vencedor</span><br><img src='img/winner.png' style='width:50%;'><br>");
                aux_history = [localStorage.getItem('p2'), localStorage.getItem('p1'), localStorage.getItem('p2')];

                history.push(aux_history);
                localStorage.setItem('history', JSON.stringify(history));

            }

            if (verificaMatrizPreenchida()) {
                $('.jogo').html("<span class='winner'><br>Velha!</span><br><img src='img/winner.png' style='width:50%;'><br>");
            }
        });

        function verificaMatrizPreenchida() {
            matrizPreechida = true;
            items.forEach((element, key) => {
                element.forEach(element => {
                    if (element === null) {
                        matrizPreechida = false;
                    }
                });
            });
            return matrizPreechida;
        }

        function verificaMatriz(simbolo) {

            if (items[0][0] == simbolo && items[0][1] == simbolo && items[0][2] == simbolo)
                return simbolo;

            if (items[1][0] == simbolo && items[1][1] == simbolo && items[1][2] == simbolo)
                return simbolo;

            if (items[2][0] == simbolo && items[2][1] == simbolo && items[2][2] == simbolo)
                return simbolo;

            if (items[0][0] == simbolo && items[1][1] == simbolo && items[2][2] == simbolo)
                return simbolo;

            if (items[2][0] == simbolo && items[1][1] == simbolo && items[0][2] == simbolo)
                return simbolo;

            if (items[0][0] == simbolo && items[1][0] == simbolo && items[2][0] == simbolo)
                return simbolo;

            if (items[0][1] == simbolo && items[1][1] == simbolo && items[2][1] == simbolo)
                return simbolo;

            if (items[0][2] == simbolo && items[1][2] == simbolo && items[2][2] == simbolo)
                return simbolo;

            return false;

        }
    </script>

</body>

</html>